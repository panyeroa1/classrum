:root{
  --bg:#0d0d0d;--surface:#161616;--surface2:#1e1e1e;--surface3:#282828;--border:#333;
  --text:#f5f5f5;--text-muted:#888;--accent:#6366f1;--accent2:#4f46e5;
  --green:#22c55e;--red:#ef4444;--blue:#3b82f6;--orange:#f97316;--yellow:#eab308;--cyan:#06b6d4;
  --nav-safe: env(safe-area-inset-bottom);
  --sidebar-width: 280px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--bg);color:var(--text);
  min-height:100vh;min-height:100dvh;overflow:hidden;
  -webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:pan-y
}
@media(max-width:1024px){body{overflow-y:auto;overflow-x:hidden}}
button{cursor:pointer;border:none;background:none;color:inherit;font:inherit}
input,select{font:inherit}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* LOADING / AUTH CHECK */
.loading-overlay{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;text-align:center}
.loading-card{background:var(--surface);border-radius:20px;padding:28px;max-width:420px;width:100%;box-shadow:0 25px 50px rgba(0,0,0,.5)}
.loading-icon{width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,var(--accent),var(--cyan));display:flex;align-items:center;justify-content:center;margin:0 auto 14px;font-size:22px}
.loading-title{font-size:18px;font-weight:700;margin-bottom:8px}
.loading-text{font-size:14px;color:var(--text-muted);line-height:1.5}
.loading-actions{margin-top:16px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.loading-btn{padding:10px 16px;border-radius:10px;background:var(--accent);color:#fff;text-decoration:none;font-size:13px;font-weight:600}
.loading-btn.secondary{background:var(--surface2);color:var(--text)}
.loading-overlay.hidden{display:none}
.is-hidden{display:none}
.text-muted-small{font-size:12px;color:var(--text-muted)}

/* QUIZ MODAL STYLES */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000;padding:20px}
.modal-content{background:var(--surface);border-radius:16px;max-width:500px;width:100%;box-shadow:0 25px 50px rgba(0,0,0,0.5)}
.modal-header{padding:20px 24px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-header h3{font-size:18px;display:flex;align-items:center;gap:8px}
.modal-close{background:none;border:none;font-size:24px;color:var(--text-muted);cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px}
.modal-close:hover{background:var(--surface2)}
.modal-body{padding:24px}
.quiz-link-container{margin:16px 0}
.quiz-link-container label{display:block;font-size:13px;color:var(--text-muted);margin-bottom:8px}
.link-input-group{display:flex;gap:8px}
.link-input-group input{flex:1;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:monospace;font-size:14px}
.btn-copy{padding:12px 16px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600}
.btn-copy:hover{background:var(--accent2)}
.quiz-info{font-size:13px;color:var(--text-muted);margin-top:12px}
.modal-actions{padding:16px 24px 24px;display:flex;gap:12px;justify-content:flex-end}
.btn-primary,.btn-secondary{padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:var(--accent2)}
.btn-secondary{background:var(--surface2);color:var(--text)}
.btn-secondary:hover{background:var(--surface3)}

/* PRE-JOIN (Modern) */
.prejoin-overlay{
  position:fixed;inset:0;display:none;z-index:9998;padding:20px;overflow-y:auto;
  background:
    radial-gradient(1200px 600px at 20% -10%, rgba(99,102,241,.20), transparent 55%),
    radial-gradient(900px 500px at 85% 10%, rgba(6,182,212,.14), transparent 60%),
    radial-gradient(900px 500px at 50% 110%, rgba(34,197,94,.10), transparent 55%),
    var(--bg);
}
.prejoin-overlay.active{display:flex;align-items:center;justify-content:center}
.prejoin-container{
  width:100%;max-width:900px;display:grid;grid-template-columns:1fr 1fr;gap:24px;
  border-radius:24px;overflow:hidden;
  background: rgba(22,22,22,.78);
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 28px 70px rgba(0,0,0,.55);
  -webkit-backdrop-filter: blur(16px);
  backdrop-filter: blur(16px);
}
@media(max-width:768px){.prejoin-container{grid-template-columns:1fr;max-width:560px}}

.prejoin-preview{
  display:flex;flex-direction:column;padding:24px;
  background:
    radial-gradient(900px 420px at 10% 10%, rgba(99,102,241,.18), transparent 55%),
    radial-gradient(700px 420px at 90% 30%, rgba(6,182,212,.12), transparent 60%),
    var(--bg);
  border-right: 1px solid rgba(255,255,255,.06);
}
@media(max-width:768px){.prejoin-preview{border-right:none;border-bottom:1px solid rgba(255,255,255,.06)}}

.prejoin-video-wrapper{
  position:relative;width:100%;aspect-ratio:16/9;
  background:rgba(30,30,30,.7);
  border-radius:16px;overflow:hidden;margin-bottom:16px;
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
}
.prejoin-video-wrapper video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1)}
.prejoin-video-off{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(30,30,30,.85);color:var(--text-muted)}
.prejoin-video-off i{font-size:48px;margin-bottom:12px}
.prejoin-video-off.hidden{display:none}

.prejoin-controls{display:flex;justify-content:center;gap:16px}
.prejoin-toggle{
  width:56px;height:56px;border-radius:50%;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(30,30,30,.85);
  display:flex;align-items:center;justify-content:center;font-size:20px;
  transition:.15s; box-shadow: 0 10px 25px rgba(0,0,0,.25);
}
.prejoin-toggle:hover{background:rgba(40,40,40,.92);transform:translateY(-1px)}
.prejoin-toggle:active{transform:translateY(0)}
.prejoin-toggle.off{background:var(--red);color:#fff}

.prejoin-form{
  padding:32px;display:flex;flex-direction:column;
  background:
    radial-gradient(900px 380px at 20% 0%, rgba(255,255,255,.06), transparent 55%),
    rgba(22,22,22,.70);
}
.prejoin-form h2{font-size:24px;margin-bottom:8px;letter-spacing:.2px;line-height:1.1}
.prejoin-form>p{color:var(--text-muted);margin-bottom:24px;font-size:14px;opacity:.95}

.prejoin-user{
  display:flex;align-items:center;gap:12px;padding:16px;
  background: rgba(30,30,30,.75);
  border-radius:12px;margin-bottom:20px;
  border: 1px solid rgba(255,255,255,.07);
}
.prejoin-user-avatar{
  width:48px;height:48px;border-radius:50%;
  background: linear-gradient(135deg,var(--accent),var(--cyan));
  display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;
  box-shadow: 0 10px 25px rgba(0,0,0,.25);
}
.prejoin-user-avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover}
.prejoin-user-info h4{font-size:16px}
.prejoin-user-info p{font-size:13px;color:var(--text-muted)}

.prejoin-room-input{display:flex;gap:8px;margin-bottom:16px;background:rgba(30,30,30,.70);padding:8px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
.prejoin-room-prefix{background:rgba(30,30,30,.86);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px 16px;font-weight:700;color:var(--accent);font-size:13px}
.prejoin-room-input input{
  flex:1;background:rgba(30,30,30,.86);border:1px solid rgba(255,255,255,.08);
  border-radius:12px;padding:14px 16px;color:var(--text);font-size:16px;font-weight:600;
  font-family:monospace;letter-spacing:3px;text-transform:uppercase
}
.prejoin-room-input input:focus{outline:none;border-color:rgba(99,102,241,.65);box-shadow:0 0 0 4px rgba(99,102,241,.18)}

.device-select-group{margin-bottom:16px}
.device-select-group label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-muted);margin-bottom:6px}
.device-select-group label i{font-size:14px}
.device-select-group input,.device-select-group select{
  width:100%;padding:12px 14px;background:rgba(30,30,30,.86);
  border:1px solid rgba(255,255,255,.08);border-radius:10px;color:var(--text);font-size:14px;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.18);
  transition:border-color .15s, box-shadow .15s, transform .15s;
}
.device-select-group input::placeholder{color:rgba(245,245,245,.35)}
.device-select-group input:focus,.device-select-group select:focus{
  outline:none;border-color:rgba(99,102,241,.65);
  box-shadow:0 0 0 4px rgba(99,102,241,.18), inset 0 0 0 1px rgba(0,0,0,.18);
}
.prejoin-form .btn-primary{
  margin-top:auto;border-radius:12px;
  background:linear-gradient(135deg,var(--accent),var(--cyan));
  box-shadow:0 14px 35px rgba(0,0,0,.35);
}
.prejoin-form .btn-primary:hover{filter:brightness(1.05);transform:translateY(-1px)}
.prejoin-form .btn-primary:active{transform:translateY(0)}
.btn-logout{
  margin-top:16px;padding:12px;
  background:rgba(30,30,30,.55);
  border:1px solid rgba(255,255,255,.10);
  border-radius:10px;color:var(--text-muted);font-size:14px
}
.btn-logout:hover{background:rgba(40,40,40,.70);color:var(--text)}

/* MAIN APP */
.app-container{display:none;height:100vh;height:100dvh;flex-direction:column}
.app-container.active{display:flex}

/* TOP HEADER (Sticky) */
.top-header{
  display:flex;align-items:center;justify-content:space-between;padding:10px 16px;
  background: rgba(22,22,22,.72);
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border-bottom:1px solid rgba(255,255,255,.08);
  flex-shrink:0;gap:12px;

  position: sticky; top: 0; z-index: 200;
}
@supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){
  .top-header{ background: var(--surface); }
}
.header-left{display:flex;align-items:center;gap:12px}
.header-logo{display:flex;align-items:center;gap:8px;font-weight:700;font-size:16px}
.header-logo .logo-icon{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),var(--cyan));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px}
.room-badge{display:flex;align-items:center;gap:8px;padding:6px 12px;background:var(--surface2);border-radius:8px;font-size:12px}
.room-badge-id{font-family:monospace;font-weight:600;color:var(--accent);letter-spacing:1px}
.room-badge-sep{color:var(--border)}
.room-badge i{color:var(--green)}
.header-center{flex:1;display:flex;justify-content:center}
.meeting-timer{display:flex;align-items:center;gap:8px;padding:6px 14px;background:var(--surface2);border-radius:8px;font-size:13px;font-family:monospace}
.meeting-timer i{color:var(--red)}
.meeting-timer.recording i{animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.header-right{display:flex;align-items:center;gap:8px}
.header-btn{width:40px;height:40px;border-radius:10px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:16px;transition:.15s;position:relative}
.header-btn:hover{background:var(--surface3)}
.header-btn.active{background:var(--accent);color:#fff}
.header-btn.danger{background:var(--red);color:#fff}
.header-btn-badge{position:absolute;top:-4px;right:-4px;min-width:18px;height:18px;background:var(--accent);border-radius:9px;font-size:10px;font-weight:600;display:flex;align-items:center;justify-content:center;padding:0 5px}

/* HEADER MENU DROPDOWN */
.header-menu-container{position:relative}
.header-menu{position:absolute;top:calc(100% + 8px);right:0;background:var(--surface);border:1px solid var(--border);border-radius:12px;min-width:200px;padding:8px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:1000;opacity:0;visibility:hidden;transform:translateY(-8px);transition:.15s}
.header-menu.active{opacity:1;visibility:visible;transform:translateY(0)}
.header-menu-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:8px;font-size:14px;width:100%;text-align:left;transition:.15s}
.header-menu-item:hover{background:var(--surface2)}
.header-menu-item i{width:20px;text-align:center;font-size:15px;color:var(--text-muted)}
.header-menu-item span{flex:1}
.header-menu-item .menu-badge{background:var(--accent);color:#fff;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}
.header-menu-item.active i{color:var(--accent)}
.header-menu-item.danger{color:var(--red)}
.header-menu-item.danger i{color:var(--red)}
.header-menu-divider{height:1px;background:var(--border);margin:8px 0}
@media(max-width:600px){.header-logo span{display:none}.room-badge{display:none}.meeting-timer span{display:none}}

/* MAIN CONTENT */
.main-content{flex:1;display:flex;overflow:hidden;position:relative}
.main-content.layout-3col{
  display:grid;
  grid-template-columns: var(--sidebar-width, 280px) minmax(0,1fr) var(--sidebar-width, 280px);
  gap:0;
}
.main-content.center-collapsed{
  grid-template-columns: var(--sidebar-width, 280px) 0 var(--sidebar-width, 280px);
}
.center-panel{min-width:0;display:flex;flex-direction:column;border-left:1px solid var(--border);border-right:1px solid var(--border);background:var(--surface)}
.main-content.center-collapsed .center-panel{display:none}

/* TEACHER PANEL */
.teacher-panel{
  width:var(--sidebar-width, 280px);
  background:var(--surface);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  gap:12px;
  padding:10px;
}
.teacher-video-slot{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  border-radius:12px;
  overflow:hidden;
  background:var(--surface2);
  border:1px solid rgba(255,255,255,.06);
}
.teacher-panel .video-grid{
  width:100%;
  height:100%;
  padding:0;
}
.teacher-panel .video-tiles-strip{display:none}
.teacher-panel .video-tile{height:100%}

.teacher-visualizer{
  background:var(--surface2);
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  padding:12px;
}
.teacher-visualizer h4{font-size:12px;letter-spacing:.5px;text-transform:uppercase;color:var(--text-muted);display:flex;align-items:center;gap:6px;margin-bottom:10px}
.audio-meter{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.audio-meter:last-child{margin-bottom:0}
.audio-meter span{font-size:11px;color:var(--text-muted);width:48px}
.meter-track{flex:1;height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
.meter-fill{height:100%;width:0%;background:linear-gradient(135deg,var(--accent),var(--cyan));transition:width .08s linear}

/* VIDEO GRID */
.video-grid{flex:1;display:grid;gap:6px;padding:8px;overflow:hidden}
.video-grid.auto-layout{grid-template-columns:repeat(auto-fit,minmax(240px,1fr));grid-auto-rows:1fr}
.video-grid[data-count="1"]{grid-template-columns:1fr}
.video-grid[data-count="2"]{grid-template-columns:repeat(2,1fr)}
.video-grid[data-count="3"],.video-grid[data-count="4"]{grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr)}
.video-grid[data-count="5"],.video-grid[data-count="6"]{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr)}
.video-grid[data-count="7"],.video-grid[data-count="8"],.video-grid[data-count="9"]{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr)}

/* Teacher-left / students-right pinned view */
.video-grid.pinned-view{grid-template-columns:1fr 280px;grid-template-rows:1fr}
.video-grid.pinned-view .video-tile.pinned{grid-row:1;grid-column:1}
.video-grid.pinned-view .video-tiles-strip{grid-row:1;grid-column:2;display:flex;flex-direction:column;gap:6px;overflow-y:auto}
.video-grid.pinned-view .video-tiles-strip .video-tile{height:160px;flex:0 0 auto}
.video-grid.pinned-view .video-tiles-strip{padding:2px}
@media(max-width:768px){
  .video-grid.pinned-view{grid-template-columns:1fr;grid-template-rows:1fr 120px}
  .video-grid.pinned-view .video-tiles-strip{flex-direction:row;overflow-x:auto}
  .video-grid.pinned-view .video-tiles-strip .video-tile{min-width:160px;height:100%}
}

.video-tile{position:relative;background:var(--surface);border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center}
.video-tile video{width:100%;height:100%;object-fit:cover}
.video-tile.mirror video{transform:scaleX(-1)}
.video-tile-overlay{position:absolute;inset:0;pointer-events:none}
.video-tile-top{position:absolute;top:8px;left:8px;right:8px;display:flex;justify-content:space-between;pointer-events:auto}
.video-tile-actions{display:flex;gap:4px;opacity:0;transition:.2s}
.video-tile:hover .video-tile-actions{opacity:1}
.video-tile-action{width:28px;height:28px;border-radius:6px;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;font-size:12px;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
.video-tile-action:hover{background:var(--accent)}
.video-tile-action.pinned{background:var(--accent)}
.video-tile-status{display:flex;gap:4px}
.video-tile-status span{width:24px;height:24px;border-radius:6px;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;font-size:10px;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
.video-tile-status .muted{color:var(--red)}
.video-tile-bottom{position:absolute;bottom:0;left:0;right:0;padding:8px 12px;background:linear-gradient(transparent,rgba(0,0,0,.7));display:flex;align-items:center;justify-content:space-between}
.video-tile-name{display:flex;align-items:center;gap:6px;font-size:13px;font-weight:500}
.video-tile-name .speaking{width:8px;height:8px;background:var(--green);border-radius:50%;animation:pulse-speak 1s infinite}
@keyframes pulse-speak{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}}
.video-placeholder{width:80px;height:80px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700}

/* SHARED CONTENT */
.shared-content{display:none;position:absolute;inset:8px;background:var(--surface);border-radius:12px;overflow:hidden;z-index:5}
.shared-content.active{display:flex;flex-direction:column}
.shared-content-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--surface2)}
.shared-content-header h4{font-size:14px;display:flex;align-items:center;gap:8px}
.shared-content-header h4 i{color:var(--accent)}
.shared-content-body{flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden}
.shared-content-body video,.shared-content-body canvas{max-width:100%;max-height:100%;object-fit:contain}
#whiteboardCanvas{background:#fff;cursor:crosshair}
.whiteboard-tools{display:flex;gap:8px;padding:8px 16px;background:var(--surface2);border-top:1px solid var(--border)}
.whiteboard-tool{width:36px;height:36px;border-radius:8px;background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:14px}
.whiteboard-tool:hover{background:var(--surface3)}
.whiteboard-tool.active{background:var(--accent);color:#fff}
.whiteboard-tool input[type="color"]{width:100%;height:100%;border:none;padding:0;cursor:pointer;border-radius:8px}

/* STUDENTS PANEL */
.students-panel{width:var(--sidebar-width, 280px);background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;position:relative;z-index:10;overflow:hidden}
.panel-section{padding:12px;border-bottom:1px solid var(--border)}
.panel-section-title{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.panel-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border)}
.panel-header h3{font-size:16px;display:flex;align-items:center;gap:8px}
.panel-header h3 i{color:var(--accent)}
.panel-close{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.panel-close:hover{background:var(--surface2)}
.students-list{flex:1;overflow-y:auto;padding:12px}
.queue-section .students-list{flex:0 0 auto;max-height:200px}
.students-section{flex:1;display:flex;flex-direction:column}
.students-section .students-list{flex:1}
.student-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;margin-bottom:8px;background:var(--surface2)}
.student-item:hover{background:var(--surface3)}
.student-avatar{width:40px;height:40px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;flex-shrink:0}
.student-avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover}
.student-info{flex:1;min-width:0}
.student-info h5{font-size:14px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.student-info p{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:4px}
.student-info p i{font-size:8px}
.student-info p .online{color:var(--green)}
.student-badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.student-badge{font-size:10px;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.08);color:var(--text-muted);border:1px solid rgba(255,255,255,.08)}
.student-badge.muted{background:rgba(239,68,68,.15);color:#ef4444;border-color:rgba(239,68,68,.35)}
.student-badge.hand{background:rgba(234,179,8,.15);color:#eab308;border-color:rgba(234,179,8,.35)}
.student-badge.granted{background:rgba(34,197,94,.15);color:#22c55e;border-color:rgba(34,197,94,.35)}
.student-actions{display:flex;flex-direction:column;gap:6px}
.student-action{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;background:var(--surface)}
.student-action:hover{background:var(--accent);color:#fff}
.student-action.muted{color:var(--red)}
.student-action.grant{background:rgba(34,197,94,.15);color:#22c55e}
.student-action.revoke{background:rgba(239,68,68,.15);color:#ef4444}
.student-hand{color:var(--yellow);animation:wave 0.5s ease-in-out infinite alternate}
@keyframes wave{0%{transform:rotate(-10deg)}100%{transform:rotate(10deg)}}

/* CHAT PANEL */
.chat-panel{width:340px;background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;transform:translateX(100%);transition:transform .3s ease;position:absolute;right:0;top:0;bottom:0;z-index:18}
.chat-panel.open{transform:translateX(0)}
.chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
.chat-message{max-width:85%;padding:10px 14px;border-radius:12px;font-size:14px;line-height:1.4;word-wrap:break-word}
.chat-message.sent{align-self:flex-end;background:var(--accent);color:#fff;border-bottom-right-radius:4px}
.chat-message.received{align-self:flex-start;background:var(--surface2);border-bottom-left-radius:4px}
.chat-message-header{display:flex;align-items:center;gap:6px;margin-bottom:4px;font-size:11px;opacity:0.8}
.chat-message-header .sender{font-weight:600}
.chat-message-header .time{opacity:0.7}
.chat-input-container{padding:12px;border-top:1px solid var(--border);display:flex;gap:8px}
.chat-input{flex:1;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:24px;color:var(--text);font-size:14px;resize:none}
.chat-input:focus{outline:none;border-color:var(--accent)}
.chat-send{width:44px;height:44px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:16px;color:#fff;flex-shrink:0}
.chat-send:hover{background:var(--accent2)}
.chat-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);text-align:center;padding:20px}
.chat-empty i{font-size:48px;margin-bottom:12px;opacity:0.5}
@media(max-width:768px){
  .chat-panel{
    position:fixed;width:100%;height:70vh;bottom:0;left:0;right:0;top:auto;
    transform:translateY(100%);border-left:none;border-top:1px solid var(--border);
    border-radius:20px 20px 0 0
  }
  .chat-panel.open{transform:translateY(0)}
}

/* RAISE HAND */
.control-btn.hand-raised{background:var(--yellow);color:#000}
.control-btn.hand-raised i{animation:wave 0.5s ease-in-out infinite alternate}
.video-tile-hand{position:absolute;top:8px;right:8px;width:32px;height:32px;background:var(--yellow);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;animation:pulse 1s ease-in-out infinite;z-index:5}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

/* TRANSCRIPT PANEL */
.transcript-panel{width:100%;background:var(--surface);display:flex;flex-direction:column;position:relative;height:100%}
.transcript-panel.expanded{width:100%}
@media(max-width:768px){.transcript-panel{width:100%}}
.transcript-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border);gap:8px;flex-wrap:wrap}
.transcript-header-left{display:flex;align-items:center;gap:10px}
.transcript-header-left h3{font-size:15px;display:flex;align-items:center;gap:8px}
.transcript-header-left h3 i{color:var(--accent)}
.btn-auto-tts{display:flex;align-items:center;gap:6px;padding:6px 12px;background:var(--surface2);border-radius:8px;font-size:12px;font-weight:500;transition:.15s}
.btn-auto-tts:hover{background:var(--surface3)}
.btn-auto-tts i{font-size:14px}
.btn-auto-tts.active{background:var(--green);color:#fff}
.btn-auto-tts .queue-count{background:var(--accent);padding:1px 6px;border-radius:8px;font-size:10px;display:none}
.btn-auto-tts .queue-count.show{display:inline}
.transcript-header-right{display:flex;align-items:center;gap:6px}
.transcript-view-toggle{display:flex;background:var(--surface2);border-radius:6px;padding:2px}
.transcript-view-toggle button{padding:5px 10px;border-radius:5px;font-size:11px;font-weight:500;color:var(--text-muted)}
.transcript-view-toggle button.active{background:var(--accent);color:#fff}
.transcript-expand{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px}
.transcript-expand:hover{background:var(--surface2)}
.transcript-collapse{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px}
.transcript-collapse:hover{background:var(--surface2)}
.transcript-tools{display:flex;gap:12px;padding:10px 16px;border-bottom:1px solid var(--border);background:var(--surface2);flex-wrap:wrap}
.transcript-tool{display:flex;flex-direction:column;gap:6px;flex:1 1 160px;min-width:160px}
.transcript-tool label{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:6px}
.transcript-tool select{width:100%;padding:8px 10px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px}
.transcript-tool select:focus{outline:none;border-color:var(--accent)}
.transcript-tool i{font-size:12px;color:var(--accent)}
.transcript-tools .hint{font-size:11px;color:var(--text-muted)}
.transcript-content{flex:1;overflow:hidden;display:flex;flex-direction:column}
.transcript-unified{flex:1;overflow-y:auto;padding:12px;scroll-behavior:smooth}
.transcript-unified.hidden{display:none}
.transcript-entry{margin-bottom:16px;padding:14px;background:var(--surface2);border-radius:12px}
.transcript-entry-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.transcript-entry-avatar{width:28px;height:28px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600}
.transcript-entry-name{font-weight:600;font-size:13px}
.transcript-entry-time{font-size:11px;color:var(--text-muted);margin-left:auto}
.transcript-entry-original{font-size:13px;line-height:1.5;padding:10px 12px;background:var(--surface);border-radius:8px;margin-bottom:8px;border-left:3px solid var(--text-muted);color:var(--text-muted)}
.transcript-entry-translation{font-size:14px;line-height:1.5;padding:10px 12px;background:rgba(99,102,241,.1);border-radius:8px;border-left:3px solid var(--accent)}
.transcript-entry-actions{display:flex;gap:8px;margin-top:10px}
.btn-play-entry{display:flex;align-items:center;gap:5px;padding:6px 12px;background:var(--surface);border-radius:6px;font-size:11px;transition:.15s}
.btn-play-entry:hover{background:var(--accent);color:#fff}
.btn-play-entry.playing{background:var(--green);color:#fff}
.transcript-split{flex:1;display:none;overflow:hidden}
.transcript-split.active{display:flex}
.transcript-column{flex:1;display:flex;flex-direction:column;min-width:0}
.transcript-column:first-child{border-right:1px solid var(--border)}
.transcript-column-header{padding:10px 14px;background:var(--surface2);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted)}
.transcript-column-content{flex:1;overflow-y:auto;padding:12px;scroll-behavior:smooth}
.transcript-line{margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid var(--border)}
.transcript-line:last-child{border-bottom:none}
.transcript-line-header{display:flex;align-items:center;gap:6px;margin-bottom:6px}
.transcript-line-avatar{width:20px;height:20px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600}
.transcript-line-name{font-size:11px;font-weight:600}
.transcript-line-time{font-size:10px;color:var(--text-muted);margin-left:auto}
.transcript-line-text{font-size:13px;line-height:1.5}
.transcript-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center;color:var(--text-muted)}
.transcript-empty i{font-size:48px;margin-bottom:16px;opacity:.5}
.transcript-empty p{font-size:14px}
@media(max-width:600px){
  .transcript-tools{flex-direction:column}
}

/* SETTINGS MODAL */
.settings-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}
.settings-overlay.open{display:flex}
.settings-modal{background:var(--surface);border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}
.settings-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border)}
.settings-header h2{font-size:20px;display:flex;align-items:center;gap:10px}
.settings-header h2 i{color:var(--accent)}
.settings-close{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px}
.settings-close:hover{background:var(--surface2)}
.settings-tabs{display:flex;padding:0 24px;gap:4px;border-bottom:1px solid var(--border);overflow-x:auto}
.settings-tab{padding:14px 20px;font-size:14px;font-weight:500;color:var(--text-muted);border-bottom:2px solid transparent;white-space:nowrap}
.settings-tab:hover{color:var(--text)}
.settings-tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.settings-content{flex:1;overflow-y:auto;padding:24px}
.settings-section{display:none}
.settings-section.active{display:block}
.settings-section h4{font-size:14px;font-weight:600;margin-bottom:16px;color:var(--text-muted);display:flex;align-items:center;gap:8px}
.settings-section h4 i{font-size:14px}
.setting-row{margin-bottom:20px}
.setting-row label{display:block;font-size:13px;font-weight:500;margin-bottom:8px}
.setting-row select,.setting-row input[type="text"]{width:100%;padding:12px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px}
.setting-row select:focus,.setting-row input:focus{outline:none;border-color:var(--accent)}
.setting-row-inline{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)}
.setting-row-inline label{margin-bottom:0}
.toggle-switch{width:48px;height:26px;background:var(--surface2);border-radius:13px;position:relative;cursor:pointer;transition:.2s}
.toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:20px;height:20px;background:var(--text);border-radius:50%;transition:.2s}
.toggle-switch.active{background:var(--green)}
.toggle-switch.active::after{left:25px}
.settings-footer{display:flex;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:1px solid var(--border)}
.btn-settings-save{padding:12px 24px;background:var(--accent);color:#fff;border-radius:10px;font-weight:600}
.btn-settings-save:hover{background:var(--accent2)}

/* CONTROL BAR (Desktop default) */
.control-bar{
  display:flex;align-items:center;justify-content:center;
  padding:12px 16px;background:var(--surface);
  border-top:1px solid var(--border);
  gap:8px;flex-shrink:0;position:relative
}
.control-btn{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:10px 16px;border-radius:12px;background:var(--surface2);
  transition:.15s;min-width:64px
}
.control-btn:hover{background:var(--surface3)}
.control-btn i{font-size:20px}
.control-btn span{font-size:10px;color:var(--text-muted)}
.control-btn.active{background:var(--accent)}
.control-btn.active span{color:#fff}
.control-btn.muted{background:var(--red)}
.control-btn.muted span{color:#fff}
.control-btn.danger{background:var(--red)}
.control-btn.danger:hover{background:#dc2626}
.control-btn.danger span{color:#fff}
.control-divider{width:1px;height:40px;background:var(--border);margin:0 8px}
.control-bar-left,.control-bar-right{position:absolute;display:flex;align-items:center;gap:8px}
.control-bar-left{left:16px}
.control-bar-right{right:16px}

/* TOAST */
.toast{
  position:fixed;bottom:100px;left:50%;transform:translateX(-50%);
  background:var(--surface);border:1px solid var(--border);
  padding:14px 24px;border-radius:12px;font-size:14px;z-index:2000;
  display:none;animation:fadeUp .3s
}
.toast.show{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* MOBILE & TABLET RESPONSIVE - PORTRAIT */
@media(max-width:1024px) and (orientation:portrait){
  .app-container{height:auto;min-height:100vh;min-height:100dvh;overflow-y:auto}
  /* Reserve space for fixed bottom bar (Zoom-like) */
  .main-content{
    flex-direction:column;overflow:visible;
    min-height:calc(100vh - 140px);min-height:calc(100dvh - 140px);
    padding-bottom: calc(92px + var(--nav-safe));
  }

  .video-area{flex:none;height:auto;min-height:200px}
  .video-grid{height:auto;min-height:180px;max-height:40vh;overflow:hidden}
  .video-grid.auto-layout{grid-template-columns:repeat(auto-fit,minmax(120px,1fr));grid-auto-rows:minmax(100px,1fr)}
  .video-grid[data-count="1"]{max-height:35vh}
  .video-grid[data-count="2"]{grid-template-columns:repeat(2,1fr)}
  .video-grid[data-count="3"],.video-grid[data-count="4"]{grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr)}
  .video-tile{min-height:80px}
  .video-tile-name{font-size:11px}
  .video-placeholder{width:50px;height:50px;font-size:20px}

  /* Mobile Transcript Panel - Below Video Grid */
  .transcript-panel{
    position:relative;width:100%;height:auto;min-height:0;max-height:0;transform:none;
    border-left:none;border-top:1px solid var(--border);
    transition:max-height .3s ease,min-height .3s ease;overflow:hidden
  }
  .transcript-panel.open{max-height:55vh;min-height:45vh;flex:1}
  .transcript-panel.expanded{max-height:70vh;min-height:60vh}
  .transcript-header{flex-wrap:nowrap;padding:10px 12px;gap:6px}
  .transcript-header-left h3{font-size:13px}
  .transcript-header-left h3 span{display:none}
  .btn-auto-tts{padding:5px 10px;font-size:11px}
  .transcript-content{min-height:0}

  /* Mobile Split View */
  .transcript-split.active{display:flex;flex-direction:row}
  .transcript-column{flex:1;min-width:0}
  .transcript-column:first-child{border-right:1px solid var(--border)}
  .transcript-column-header{padding:8px 10px;font-size:10px}
  .transcript-column-content{padding:8px}
  .transcript-line{margin-bottom:10px;padding-bottom:10px}
  .transcript-line-text{font-size:12px}
  .transcript-line-avatar{width:16px;height:16px;font-size:8px}
  .transcript-line-name{font-size:10px}
  .transcript-line-time{font-size:9px}

  /* Mobile Unified View */
  .transcript-unified{padding:10px}
  .transcript-entry{padding:10px;margin-bottom:12px}
  .transcript-entry-header{gap:8px;margin-bottom:8px}
  .transcript-entry-avatar{width:24px;height:24px;font-size:10px}
  .transcript-entry-name{font-size:12px}
  .transcript-entry-time{font-size:10px}
  .transcript-entry-original,.transcript-entry-translation{font-size:12px;padding:8px 10px}
  .transcript-entry-actions{margin-top:8px}
  .btn-play-entry{padding:5px 10px;font-size:10px}

  /* Students Panel Mobile */
  .students-panel{
    position:fixed;width:100%;height:70vh;bottom:0;left:0;right:0;top:auto;
    transform:translateY(100%);border-left:none;border-top:1px solid var(--border);
    border-radius:20px 20px 0 0
  }
  .students-panel.open{transform:translateY(0)}

  /* Header Mobile */
  .top-header{padding:8px 12px}
  .header-btn{width:36px;height:36px;font-size:14px}
  .header-btn-badge{min-width:16px;height:16px;font-size:9px}

  /* Shared Content Mobile */
  .shared-content{position:relative;inset:0;margin:8px;border-radius:10px;max-height:35vh}

  /* ===== Zoom-like Bottom Navbar (Mobile) ===== */
  .control-bar{
    position:fixed;
    left:0;right:0;bottom:0;
    z-index:250;
    justify-content:flex-start;
    gap:0;
    padding:10px 10px calc(10px + var(--nav-safe));
    background: rgba(22,22,22,.78);
    -webkit-backdrop-filter: blur(14px);
    backdrop-filter: blur(14px);
    border-top:1px solid rgba(255,255,255,.10);

    overflow-x:auto;
    overflow-y:hidden;
    flex-wrap:nowrap;
    -webkit-overflow-scrolling:touch;
    scrollbar-width:none;
  }
  .control-bar::-webkit-scrollbar{display:none}

  .control-bar-left,.control-bar-right{display:none}
  .control-divider{display:none}

  .control-btn{
    background:transparent;
    border-radius:14px;
    min-width:78px;
    padding:8px 10px;
    margin:0 2px;
  }
  .control-btn:hover{background:rgba(255,255,255,.06)}
  .control-btn i{font-size:22px}
  .control-btn span{
    display:block;
    font-size:11px;
    color:rgba(245,245,245,.72);
    margin-top:6px;
  }
  .control-btn.active{
    background:rgba(99,102,241,.16);
    border:1px solid rgba(99,102,241,.22);
  }
  .control-btn.muted{
    background:rgba(239,68,68,.16);
    border:1px solid rgba(239,68,68,.28);
  }
  .control-btn.danger{
    background:rgba(239,68,68,.22);
    border:1px solid rgba(239,68,68,.35);
  }

  /* Toast higher because bar is fixed */
  .toast{bottom: calc(110px + var(--nav-safe));}
}

/* TABLET LANDSCAPE */
@media(min-width:768px) and (max-width:1024px) and (orientation:landscape){
  .video-grid.auto-layout{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  .transcript-panel{width:320px}
  .transcript-panel.expanded{width:45vw}
}

/* SMALL PHONES */
@media(max-width:480px){
  .prejoin-container{border-radius:16px}
  .prejoin-preview{padding:16px}
  .prejoin-form{padding:20px}
  .prejoin-form h2{font-size:20px}
  .prejoin-video-wrapper{aspect-ratio:4/3}
  .prejoin-toggle{width:48px;height:48px;font-size:18px}
  .device-select-group select{padding:10px 12px;font-size:13px}
  .device-select-group label{font-size:12px}
  .prejoin-room-input input{padding:12px 14px;font-size:14px;letter-spacing:2px}
  .prejoin-room-prefix{padding:12px 14px;font-size:12px}
  .btn-primary{padding:14px 20px;font-size:14px}

  .video-grid{padding:4px;gap:4px}
  .video-tile{border-radius:8px}
  .video-tile-bottom{padding:6px 8px}
  .video-tile-name{font-size:10px}
  .video-placeholder{width:40px;height:40px;font-size:16px}

  .settings-modal{border-radius:16px}
  .settings-header{padding:16px 20px}
  .settings-header h2{font-size:18px}
  .settings-content{padding:16px}
  .settings-tab{padding:12px 14px;font-size:13px}

  /* Zoom-like tighter buttons */
  @media(orientation:portrait){
    .control-btn{min-width:72px;padding:8px 8px}
    .control-btn i{font-size:21px}
    .control-btn span{font-size:10px}
  }
}
  
